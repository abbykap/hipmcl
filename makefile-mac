
OPT = -DNDEBUG -O2 -DMPICH_IGNORE_CXX_SEEK -DGRAPH_GENERATOR_SEQ -Wreturn-type
DEB = -g -O0 -fno-inline -DMPICH_IGNORE_CXX_SEEK -DGRAPH_GENERATOR_SEQ -Wreturn-type -DDEBUG 
COMPILER = mpicxx -std=c++11 -std=c++14 -DTHREADED -fopenmp  -fpermissive  
FLAGS = $(OPT)  -Wall -DTIMING #-DCOMBBLAS_DEBUG #$(MCL_FLAGS)
MCL_FLAGS = -DSHOW_MEMORY_USAGE
COMBBLAS = src/CombBLAS
BIN = bin
SRC = src

all: hipmcl 


$(COMBBLAS)/CommGrid.o:	$(COMBBLAS)/CommGrid.cpp $(COMBBLAS)/CommGrid.h
	$(COMPILER)  $(FLAGS) -c -o $(COMBBLAS)/CommGrid.o $(COMBBLAS)/CommGrid.cpp 
$(COMBBLAS)/mmio.o: $(COMBBLAS)/mmio.c
	mpicc $(FLAGS) -c -o $(COMBBLAS)/mmio.o $(COMBBLAS)/mmio.c

$(COMBBLAS)/MPIType.o:	$(COMBBLAS)/MPIType.cpp $(COMBBLAS)/MPIType.h
	$(COMPILER) $(FLAGS) -c -o $(COMBBLAS)/MPIType.o $(COMBBLAS)/MPIType.cpp 

$(COMBBLAS)/hash.o:	$(COMBBLAS)/hash.cpp $(COMBBLAS)/hash.hpp
	$(COMPILER) $(FLAGS) -c -o $(COMBBLAS)/hash.o $(COMBBLAS)/hash.cpp

$(SRC)/HipMCL.o:  $(SRC)/HipMCL.cpp $(SRC)/CC.h $(SRC)/WriteMCLClusters.h $(COMBBLAS)/SpParMat.h $(COMBBLAS)/ParFriends.h $(COMBBLAS)/SpParMat.cpp
	$(COMPILER) $(FLAGS) -c -o $(SRC)/HipMCL.o $(SRC)/HipMCL.cpp 
hipmcl:	$(SRC)/HipMCL.o  $(COMBBLAS)/CommGrid.o $(COMBBLAS)/MPIType.o $(COMBBLAS)/mmio.o $(COMBBLAS)/hash.o
	$(COMPILER) $(FLAGS)  -o $(BIN)/hipmcl $(SRC)/HipMCL.o $(COMBBLAS)/mmio.o $(COMBBLAS)/CommGrid.o $(COMBBLAS)/MPIType.o $(COMBBLAS)/hash.o



clean:
	
	rm -f $(BIN)/hipmcl 
	rm -f $(SRC)/*.o
	rm -f *.o
	rm -f $(COMBBLAS)/*.o
